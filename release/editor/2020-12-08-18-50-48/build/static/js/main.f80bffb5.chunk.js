(this.webpackJsonpreactplayer=this.webpackJsonpreactplayer||[]).push([[0],{16:function(e,t,a){e.exports=a(50)},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){},48:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),i=a(9),o=a.n(i),r=a(1),s=a(10),l=a(11),d=a(14),u=a(15),p=a(12),m=a.n(p),S=a(3),f=(a(41),function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={progress:-1,duration:-1,gotoAfterStopSec:-1,endSec:-1,playing:!0},n.$player=c.a.createRef(),n}return Object(l.a)(a,[{key:"handleDuration",value:function(e){this.setState({duration:e})}},{key:"stopAndReturn",value:function(){var e=this.state.gotoAfterStopSec;this.setState({endSec:-1,gotoAfterStopSec:-1,playing:!1}),this.$player.current.seekTo(e,"seconds")}},{key:"handleProgress",value:function(e){var t=e.playedSeconds;this.state.endSec>0&&t>this.state.endSec&&this.stopAndReturn(),this.setState({progress:t}),this.props.onProgressUpdate(t)}},{key:"handleOnPlay",value:function(){this.setState({playing:!0})}},{key:"handleOnReady",value:function(){console.log("ready!")}},{key:"handleStop",value:function(){this.setState({playing:!1})}},{key:"playSection",value:function(e,t,a){this.$player.current.seekTo(e,"seconds"),this.setState({gotoAfterStopSec:Math.max("STAY_AT_END"===a?t:e,0),endSec:Math.max(t,.01),playing:!0})}},{key:"seekTo",value:function(e){this.$player.current.seekTo(e,"seconds")}},{key:"seekToAndStop",value:function(e){this.setState({playing:!1}),this.$player.current.seekTo(e,"seconds")}},{key:"maybeStop1SecPlaying",value:function(e){this.state.playing&&this.state.gotoAfterStopSec>0?(this.stopAndReturn(),setTimeout(e.bind(this),100)):e()}},{key:"onMoveToClick",value:function(e){var t=this;this.maybeStop1SecPlaying((function(){t.$player.current.seekTo(Math.max(t.state.progress+e,0),"seconds")}))}},{key:"handlePlayOneSecBefore",value:function(){var e=this;this.maybeStop1SecPlaying((function(){e.playSection(e.state.progress-1,e.state.progress,"STAY_AT_END")}))}},{key:"handlePlayOneSecAfter",value:function(){var e=this;this.maybeStop1SecPlaying((function(){e.playSection(e.state.progress,e.state.progress+1,"STAY_AT_START")}))}},{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:"playWithNavButtons"},c.a.createElement(m.a,{ref:this.$player,url:this.props.videoUrl,width:"100%",height:"100%",onDuration:this.handleDuration.bind(this),onProgress:this.handleProgress.bind(this),onPlay:this.handleOnPlay.bind(this),onReady:this.handleOnReady.bind(this),progressInterval:100,onPause:this.handleStop.bind(this),onEnded:this.handleStop.bind(this),playing:this.state.playing,controls:!0}),c.a.createElement("div",{className:"positionAndControls"},"Current position: ",c.a.createElement("span",{className:"position"},Object(S.a)(this.state.progress)),c.a.createElement("div",{className:"controls"},[-5,-1,-.5,-.1,.1,.5,1,5].map((function(t){return c.a.createElement("div",{className:"gotoButton",onClick:function(){return e.onMoveToClick(t)}.bind(e)},t>0?"+"+t:t)})),c.a.createElement("div",{className:"gotoButton",onClick:this.handlePlayOneSecBefore.bind(this)},"Play 1 sec before"),c.a.createElement("div",{className:"gotoButton",onClick:this.handlePlayOneSecAfter.bind(this)},"Play 1 sec after"))))}}]),a}(c.a.Component));a(42);var h=function(e){var t=e.$player,a=e.section,n=e.sectionIdx,i=e.videoPlayerPosSecs,o=e.onSectionChanged,r=e.getPrevSectionEndSec;return c.a.createElement("div",{className:"sectionPosition"},c.a.createElement("div",{className:"title"},"Selected Section #",n+1," (",Object(S.a)(a.startSec)," - ",Object(S.a)(a.endSec),")"),c.a.createElement("div",{className:"playerPosition"},function(){var e,t=i-a.startSec,n=i-a.endSec;return t>=0&&n<=0?e="inside":t<0?e="before":n>0&&(e="after"),c.a.createElement("span",{className:e},"Section start delta=",t.toFixed(1),", delta end delta=",n.toFixed(1))}()),c.a.createElement("div",{className:"controls"},c.a.createElement("div",{className:"button",onClick:function(){t.playSection(a.startSec,a.endSec,"STAY_AT_START")}},"Play the whole section"),c.a.createElement("div",{className:"group"},c.a.createElement("div",{className:"button",onClick:function(){t.seekToAndStop(a.startSec)}},"Jump to section start"),c.a.createElement("div",{className:"button",onClick:function(){t.seekToAndStop(a.endSec)}},"Jump to section end")),c.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a));e.startSec=r(),o(e,void 0,"update section start time")}},"Set section start at prev. section end"),c.a.createElement("div",{className:"group"},c.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a));e.startSec=parseFloat(i.toFixed(1)),o(e,void 0,"update section start time")}},"Set as section's start time"),c.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a));e.endSec=parseFloat(i.toFixed(1)),o(e,void 0,"update section end time")}},"Set as section's end time")),a.startSec<i&&a.endSec>i?c.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a)),t=a.endSec;e.endSec=parseFloat(i.toFixed(1)),o(e,JSON.parse(JSON.stringify({startSec:e.endSec,endSec:t,pages:e.pages})),"split section")}},"Split section at ",Object(S.a)(i)):""))};a(43);var g=function(e){var t=e.sections,a=e.onSectionSelected,i=e.onSectionsChanged,o=Object(n.useState)(-1),s=Object(r.a)(o,2),l=s[0],d=s[1],u=Object(n.useState)(-1),p=Object(r.a)(u,2),m=p[0],f=p[1],h=Object(n.useRef)(null),g=function(e,t){d(e),console.log(t),a(e,t)};return Object(n.useEffect)((function(){h.current&&m>=0&&(h.current.scrollIntoView(),f(-1))})),c.a.createElement("div",{className:"sections"},c.a.createElement("div",{className:"scrolling"},c.a.createElement("div",{className:"addButton",onClick:function(){var e=JSON.parse(JSON.stringify(t));e.length>0?e.push({startSec:t[t.length-1].endSec,endSec:t[t.length-1].endSec+10}):e.push({startSec:0,endSec:10}),i(e,"add section"),f(e.length-1),g(e.length-1,e[e.length-1])}.bind(null)},"Add section"),t.map((function(e,a){var n=e.startSec,i=e.endSec;return c.a.createElement("div",{className:"button ".concat(l===a?"active":""),key:a,onClick:g.bind(null,a,t[a]),ref:a==m?h:null},"Section ",a+1,": ",Object(S.a)(n)," - ",Object(S.a)(i))}))))};a(44);a(45);var v=function(e){var t=this,a=e.title,i=e.imgUrl,o=e.width,s=e.areas,l=e.onNewAreaAdded,d=e.onDeleteArea,u=Object(n.useState)(null),p=Object(r.a)(u,2),m=p[0],S=p[1],f=Object(n.useState)(!1),h=Object(r.a)(f,2),g=h[0],v=h[1],O=Object(n.useState)(!1),b=Object(r.a)(O,2),y=b[0],E=b[1],N=Object(n.useState)(0),j=Object(r.a)(N,2),k=j[0],C=j[1],P=Object(n.useState)(0),A=Object(r.a)(P,2),J=A[0],w=A[1],T=Object(n.useState)(0),x=Object(r.a)(T,2),U=x[0],D=x[1],R=Object(n.useState)(0),M=Object(r.a)(R,2),I=M[0],B=M[1],F=Object(n.useState)(-1),_=Object(r.a)(F,2),$=_[0],L=_[1],Y=Object(n.useRef)(null);m||((m=new Image).src=i,m.onload=function(){v(!0)},S(m));var V=1*o/m.width,z=100,W=function(){if(Y&&Y.current&&m&&m.width&&m.height&&g){var e=Y.current.getContext("2d");z=parseInt(m.height*V),e.drawImage(m,0,0,m.width,m.height,0,0,o,z),s.forEach((function(t,a){e.fillStyle=a==$?"rgba(255, 0, 0, 0.7)":"rgba(255, 255, 0, 0.5)",e.fillRect(t.x*V,t.y*V,t.width*V,t.height*V)})),y&&(e.fillStyle="rgba(255, 0, 0, 0.5)",e.fillRect(k,J,U,I))}};function X(e,t){var a=e.getBoundingClientRect();return[t.clientX-a.left,t.clientY-a.top]}return W(),Object(n.useEffect)((function(){W()})),c.a.createElement("div",{className:"imageAreas"},c.a.createElement("div",{className:"canvas"},c.a.createElement("div",{className:"title"},a),c.a.createElement("canvas",{width:o,height:z,ref:Y,onMouseMove:function(e){var t=X(Y.current,e),a=Object(r.a)(t,2),n=a[0],c=a[1];y&&(D(n-k),B(c-J))},onMouseOut:function(e){E(!1)},onMouseDown:function(e){var t=X(Y.current,e),a=Object(r.a)(t,2),n=a[0],c=a[1];E(!0),C(n),w(c),B(0),D(0)},onMouseUp:function(e){z>10&&o>10&&l({x:parseInt(k/V),y:parseInt(J/V),width:parseInt(U/V),height:parseInt(I/V)}),E(!1)}})),c.a.createElement("div",{className:"controls"},s.map((function(e,a){return c.a.createElement("div",{className:"item",onMouseOver:function(){L(a)}.bind(t),onMouseOut:function(){L(-1)}.bind(t)},c.a.createElement("div",{onClick:function(){d(a)}},"Area ",a+1,c.a.createElement("img",{src:"https://images2.imgbox.com/99/8d/YaJAz5hZ_o.png",width:16})))}))))};a(46);var O=function(e){var t=this,a=e.pages,n=e.sectionPages,i=e.sectionPageAreas,o=e.onSectionPagesChanges,r=e.onSectionPageAreasChanged;return c.a.createElement("div",{className:"sectionPages"},a.map((function(e,i){return c.a.createElement("div",null,c.a.createElement("input",{type:"checkbox",checked:n.indexOf(e.id)>=0,onChange:function(e){return function(e,t){var c=JSON.parse(JSON.stringify(n)),i=a[t];e.target.checked?c.push(i.id):c=c.filter((function(e){return e!=i.id})),o(c,"list of section pages updated")}(e,i)}.bind(t)})," Page #",i+1)})),a.map((function(e,a){return n.indexOf(e.id)>=0?c.a.createElement("div",{className:"page"},c.a.createElement(v,{title:"Page #".concat(a+1),imgUrl:e.url,width:500,areas:i[e.id]||[],onNewAreaAdded:function(t){return function(e,t){var a=JSON.parse(JSON.stringify(i));a[e]?a[e].push(t):a[e]=[t],r(a,"page area added")}(e.id,t)}.bind(t),onDeleteArea:function(t){return function(e,t){var a=JSON.parse(JSON.stringify(i));a[e].splice(t,1),r(a,"page area deleted")}(e.id,t)}.bind(t)})):""})))};a(47);var b=function(e){var t=e.sections,a=e.pages,i=e.videoUrl,o=e.onDataUpdated,s=Object(n.useState)(-1),l=Object(r.a)(s,2),d=l[0],u=l[1],p=Object(n.useState)(0),m=Object(r.a)(p,2),S=m[0],v=m[1],b=Object(n.useRef)(null);return d>=t.length&&(d=-1,u(-1)),c.a.createElement("div",{className:"editor"},c.a.createElement("div",null,c.a.createElement(f,{videoUrl:i,onProgressUpdate:function(e){v(parseFloat(e.toFixed(1)))},ref:b}),d>=0?c.a.createElement("div",null,c.a.createElement(h,{$player:b.current,section:t[d],sectionIdx:d,onSectionChanged:function(e,n,c){var r=JSON.parse(JSON.stringify(t));r[d]=e,n&&r.splice(d+1,0,n),o({sections:r,pages:a,videoUrl:i},c)},videoPlayerPosSecs:S,getPrevSectionEndSec:function(){return 0==d?0:t[d-1].endSec}}),c.a.createElement(O,{pages:a||[],sectionPages:t[d].pages||[],sectionPageAreas:t[d].pageAreas||{},onSectionPagesChanges:function(e,n){var c=JSON.parse(JSON.stringify(t));c[d].pages=e,o({sections:c,pages:a,videoUrl:i},n)},onSectionPageAreasChanged:function(e,n){var c=JSON.parse(JSON.stringify(t));c[d].pageAreas=e,o({sections:c,pages:a,videoUrl:i},n)}})):""),c.a.createElement(g,{sections:t,onSectionSelected:function(e,t){u(e),b.current.seekToAndStop(t.startSec)},onSectionsChanged:function(e,t){o({sections:e,pages:a,videoUrl:i},t)}}))};a(48),a(49);function y(e){var t=e.lastStateFromLocalStorage,a=e.onDataProvided,i=Object(n.useState)(""),o=Object(r.a)(i,2),s=o[0],l=o[1],d=Object(n.useState)(""),u=Object(r.a)(d,2),p=u[0],m=u[1],S=Object(n.useState)(""),f=Object(r.a)(S,2),h=f[0],g=f[1],v=Object(n.useState)(""),O=Object(r.a)(v,2),b=O[0],y=O[1],E=function(e){m(e)};return c.a.createElement("table",{className:"editorDataProvider"},c.a.createElement("tbody",null,c.a.createElement("tr",null,c.a.createElement("td",{className:"firstCol",onClick:E.bind(this,"new")},c.a.createElement("input",{type:"radio",name:"operation",onChange:E.bind(this,"new"),checked:"new"==p}),"\xa0 Create new"),c.a.createElement("td",{className:"secondCol"},c.a.createElement("p",null,"Video URL:"),c.a.createElement("p",null,c.a.createElement("input",{type:"text",onChange:function(e){g(e.target.value)},value:h,readOnly:"new"!=p})),c.a.createElement("p",null,"Sheet music pages (one URL per line):"),c.a.createElement("p",null,c.a.createElement("textarea",{onChange:function(e){y(e.target.value)},value:b,readOnly:"new"!=p})))),c.a.createElement("tr",null,c.a.createElement("td",{className:"firstCol",onClick:E.bind(this,"loadOld")},c.a.createElement("input",{type:"radio",name:"operation",onChange:E.bind(this,"loadOld"),checked:"loadOld"==p}),"\xa0 Load old"),c.a.createElement("td",{className:"secondCol"},c.a.createElement("p",null,"Old sections content (paste here)"),c.a.createElement("p",null,c.a.createElement("textarea",{onChange:function(e){l(e.target.value)},value:s,readOnly:"loadOld"!=p})))),t?c.a.createElement("tr",null,c.a.createElement("td",{className:"firstCol",onClick:E.bind(this,"restore")},c.a.createElement("input",{type:"radio",name:"operation",onChange:E.bind(this,"restore"),checked:"restore"==p}),"\xa0 Restore from local storage"),c.a.createElement("td",{className:"secondCol"},c.a.createElement("a",{href:JSON.parse(t).videoUrl,target:"_blank"},JSON.parse(t).videoUrl))):"",p?c.a.createElement("tr",null,c.a.createElement("td",{className:"lastRow"},c.a.createElement("button",{onClick:function(){switch(p){case"loadOld":return void a(JSON.parse(s));case"restore":return void a(JSON.parse(t));case"new":return void a({videoUrl:h,sections:[],pages:b.trim().split("\n").map((function(e){return e.trim()})).filter((function(e){return e})).map((function(e){return{url:e,id:""+(new Date).getTime()+Math.random()}}))});default:alert("TBD")}}},"Submit")),c.a.createElement("td",{className:"lastRow"})):""))}var E=function(e){var t=Object(n.useState)(Object(S.b)(e)),a=Object(r.a)(t,2),i=a[0],o=a[1],s=Object(n.useState)([]),l=Object(r.a)(s,2),d=l[0],u=l[1],p=Object(n.useState)([]),m=Object(r.a)(p,2),f=m[0],h=m[1],g=Object(n.useRef)(null),v=function(e){o(e),window.localStorage.setItem("emptybarsEditorData",JSON.stringify(Object(S.c)(e)))};return c.a.createElement("div",null,i.videoUrl?c.a.createElement("div",{className:"editorLoader"},c.a.createElement(b,Object.assign({},i,{onDataUpdated:function(e,t){var a={oldData:JSON.parse(JSON.stringify(i)),newData:JSON.parse(JSON.stringify(e)),operationName:t};v(e),d.push(a),u(d),h(f=[])}})),c.a.createElement("textarea",{readOnly:!0,value:JSON.stringify(Object(S.c)(i),null,2),ref:g}),c.a.createElement("div",{className:"copyButton",onClick:function(){g.current.select(),document.execCommand("copy"),alert("Copied!")}},"copy"),d.length>0?c.a.createElement("div",null,"Last operation: ",d[d.length-1].operationName," ",c.a.createElement("span",{className:"undoButton",onClick:function(){var e=d.pop();v(e.oldData),u(d),f.push(e),h(f)}},"undo")):"",f.length>0?c.a.createElement("div",null,"Cancelled operation: ",f[f.length-1].operationName," ",c.a.createElement("span",{className:"undoButton",onClick:function(){var e=f.pop();v(e.newData),d.push(e),u(d),h(f)}},"redo")):""):c.a.createElement(y,{lastStateFromLocalStorage:window.localStorage.getItem("emptybarsEditorData"),onDataProvided:function(e){v(Object(S.b)(e))}}))},N=a(13);Object(N.a)((function(e,t){var a=t.sections,n=t.pages,i=t.videoUrl;t.videoTitle;o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(E,{sections:a||[],pages:n||[],videoUrl:i})),e)}))}},[[16,1,2]]]);
//# sourceMappingURL=main.f80bffb5.chunk.js.map