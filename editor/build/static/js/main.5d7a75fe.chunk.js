(this.webpackJsonpreactplayer=this.webpackJsonpreactplayer||[]).push([[0],{16:function(e,t,a){e.exports=a(50)},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){},48:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(9),s=a.n(c),i=a(1),o=a(10),l=a(11),d=a(14),u=a(15),m=a(12),g=a.n(m),p=a(3),f=(a(41),function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={progress:-1,duration:-1,gotoAfterStopSec:-1,endSec:-1,playing:!0},n.$player=r.a.createRef(),n}return Object(l.a)(a,[{key:"handleDuration",value:function(e){this.setState({duration:e})}},{key:"stopAndReturn",value:function(){var e=this.state.gotoAfterStopSec;this.setState({endSec:-1,gotoAfterStopSec:-1,playing:!1}),this.$player.current.seekTo(e,"seconds")}},{key:"handleProgress",value:function(e){var t=e.playedSeconds;this.state.endSec>0&&t>this.state.endSec&&this.stopAndReturn(),this.setState({progress:t}),this.props.onProgressUpdate(t)}},{key:"handleOnPlay",value:function(){this.setState({playing:!0})}},{key:"handleOnReady",value:function(){console.log("ready!")}},{key:"handleStop",value:function(){this.setState({playing:!1})}},{key:"playFragment",value:function(e,t,a){this.$player.current.seekTo(e,"seconds"),this.setState({gotoAfterStopSec:Math.max("STAY_AT_END"===a?t:e,0),endSec:Math.max(t,.01),playing:!0})}},{key:"seekTo",value:function(e){this.$player.current.seekTo(e,"seconds")}},{key:"seekToAndStop",value:function(e){this.setState({playing:!1}),this.$player.current.seekTo(e,"seconds")}},{key:"maybeStop1SecPlaying",value:function(e){this.state.playing&&this.state.gotoAfterStopSec>0?(this.stopAndReturn(),setTimeout(e.bind(this),100)):e()}},{key:"onMoveToClick",value:function(e){var t=this;this.maybeStop1SecPlaying((function(){t.$player.current.seekTo(Math.max(t.state.progress+e,0),"seconds")}))}},{key:"handlePlayOneSecBefore",value:function(){var e=this;this.maybeStop1SecPlaying((function(){e.playFragment(e.state.progress-1,e.state.progress,"STAY_AT_END")}))}},{key:"handlePlayOneSecAfter",value:function(){var e=this;this.maybeStop1SecPlaying((function(){e.playFragment(e.state.progress,e.state.progress+1,"STAY_AT_START")}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"playWithNavButtons"},r.a.createElement(g.a,{ref:this.$player,url:this.props.videoUrl,width:"100%",height:"100%",onDuration:this.handleDuration.bind(this),onProgress:this.handleProgress.bind(this),onPlay:this.handleOnPlay.bind(this),onReady:this.handleOnReady.bind(this),progressInterval:100,onPause:this.handleStop.bind(this),onEnded:this.handleStop.bind(this),playing:this.state.playing,controls:!0}),r.a.createElement("div",{className:"positionAndControls"},"Current position: ",r.a.createElement("span",{className:"position"},Object(p.a)(this.state.progress)),r.a.createElement("div",{className:"controls"},[-5,-1,-.5,-.1,.1,.5,1,5].map((function(t){return r.a.createElement("div",{className:"gotoButton",onClick:function(){return e.onMoveToClick(t)}.bind(e)},t>0?"+"+t:t)})),r.a.createElement("div",{className:"gotoButton",onClick:this.handlePlayOneSecBefore.bind(this)},"Play 1 sec before"),r.a.createElement("div",{className:"gotoButton",onClick:this.handlePlayOneSecAfter.bind(this)},"Play 1 sec after"))))}}]),a}(r.a.Component));a(42);var h=function(e){var t=e.$player,a=e.fragment,n=e.fragmentIdx,c=e.videoPlayerPosSecs,s=e.onFragmentChanged,i=e.getPrevFragmentEndSec;return r.a.createElement("div",{className:"fragmentPosition"},r.a.createElement("div",{className:"title"},"Selected Fragment #",n+1," (",Object(p.a)(a.startSec)," - ",Object(p.a)(a.endSec),")"),r.a.createElement("div",{className:"playerPosition"},function(){var e,t=c-a.startSec,n=c-a.endSec;return t>=0&&n<=0?e="inside":t<0?e="before":n>0&&(e="after"),r.a.createElement("span",{className:e},"Fragment start delta=",t.toFixed(1),", delta end delta=",n.toFixed(1))}()),r.a.createElement("div",{className:"controls"},r.a.createElement("div",{className:"button",onClick:function(){t.playFragment(a.startSec,a.endSec,"STAY_AT_START")}},"Play the whole fragment"),r.a.createElement("div",{className:"group"},r.a.createElement("div",{className:"button",onClick:function(){t.seekToAndStop(a.startSec)}},"Jump to fragment start"),r.a.createElement("div",{className:"button",onClick:function(){t.seekToAndStop(a.endSec)}},"Jump to fragment end")),r.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a));e.startSec=i(),s(e,void 0,"update fragment start time")}},"Set fragment start at prev. fragment end"),r.a.createElement("div",{className:"group"},r.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a));e.startSec=parseFloat(c.toFixed(1)),s(e,void 0,"update fragment start time")}},"Set as fragment's start time"),r.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a));e.endSec=parseFloat(c.toFixed(1)),s(e,void 0,"update fragment end time")}},"Set as fragment's end time")),a.startSec<c&&a.endSec>c?r.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a)),t=a.endSec;e.endSec=parseFloat(c.toFixed(1)),s(e,JSON.parse(JSON.stringify({startSec:e.endSec,endSec:t,pages:e.pages})),"split fragment")}},"Split fragment at ",Object(p.a)(c)):""))};a(43);var S=function(e){var t=e.fragments,a=e.onFragmentSelected,c=e.onFragmentsChanged,s=Object(n.useState)(-1),o=Object(i.a)(s,2),l=o[0],d=o[1],u=Object(n.useState)(-1),m=Object(i.a)(u,2),g=m[0],f=m[1],h=Object(n.useRef)(null),S=function(e,t){d(e),console.log(t),a(e,t)};return Object(n.useEffect)((function(){h.current&&g>=0&&(h.current.scrollIntoView(),f(-1))})),r.a.createElement("div",{className:"fragments"},r.a.createElement("div",{className:"scrolling"},r.a.createElement("div",{className:"addButton",onClick:function(){var e=JSON.parse(JSON.stringify(t));e.length>0?e.push({startSec:t[t.length-1].endSec,endSec:t[t.length-1].endSec+10}):e.push({startSec:0,endSec:10}),c(e,"add fragment"),f(e.length-1),S(e.length-1,e[e.length-1])}.bind(null)},"Add fragment"),t.map((function(e,a){var n=e.startSec,c=e.endSec;return r.a.createElement("div",{className:"button ".concat(l===a?"active":""),key:a,onClick:S.bind(null,a,t[a]),ref:a==g?h:null},"Fragment ",a+1,": ",Object(p.a)(n)," - ",Object(p.a)(c))}))))};a(44);a(45);var v=function(e){var t=this,a=e.title,c=e.imgUrl,s=e.width,o=e.areas,l=e.onNewAreaAdded,d=e.onDeleteArea,u=Object(n.useState)(null),m=Object(i.a)(u,2),g=m[0],p=m[1],f=Object(n.useState)(!1),h=Object(i.a)(f,2),S=h[0],v=h[1],O=Object(n.useState)(!1),b=Object(i.a)(O,2),y=b[0],E=b[1],N=Object(n.useState)(0),j=Object(i.a)(N,2),k=j[0],C=j[1],P=Object(n.useState)(0),A=Object(i.a)(P,2),w=A[0],J=A[1],F=Object(n.useState)(0),T=Object(i.a)(F,2),x=T[0],D=T[1],U=Object(n.useState)(0),R=Object(i.a)(U,2),M=R[0],B=R[1],I=Object(n.useState)(-1),$=Object(i.a)(I,2),_=$[0],L=$[1],Y=Object(n.useRef)(null);g||((g=new Image).src=c,g.onload=function(){v(!0)},p(g));var V=1*s/g.width,W=100,X=function(){if(Y&&Y.current&&g&&g.width&&g.height&&S){var e=Y.current.getContext("2d");W=parseInt(g.height*V),e.drawImage(g,0,0,g.width,g.height,0,0,s,W),o.forEach((function(t,a){e.fillStyle=a==_?"rgba(255, 0, 0, 0.7)":"rgba(255, 255, 0, 0.5)",e.fillRect(t.x*V,t.y*V,t.width*V,t.height*V)})),y&&(e.fillStyle="rgba(255, 0, 0, 0.5)",e.fillRect(k,w,x,M))}};function q(e,t){var a=e.getBoundingClientRect();return[t.clientX-a.left,t.clientY-a.top]}return X(),Object(n.useEffect)((function(){X()})),r.a.createElement("div",{className:"imageAreas"},r.a.createElement("div",{className:"canvas"},r.a.createElement("div",{className:"title"},a),r.a.createElement("canvas",{width:s,height:W,ref:Y,onMouseMove:function(e){var t=q(Y.current,e),a=Object(i.a)(t,2),n=a[0],r=a[1];y&&(D(n-k),B(r-w))},onMouseOut:function(e){E(!1)},onMouseDown:function(e){var t=q(Y.current,e),a=Object(i.a)(t,2),n=a[0],r=a[1];E(!0),C(n),J(r),B(0),D(0)},onMouseUp:function(e){W>10&&s>10&&l({x:parseInt(k/V),y:parseInt(w/V),width:parseInt(x/V),height:parseInt(M/V)}),E(!1)}})),r.a.createElement("div",{className:"controls"},o.map((function(e,a){return r.a.createElement("div",{className:"item",onMouseOver:function(){L(a)}.bind(t),onMouseOut:function(){L(-1)}.bind(t)},r.a.createElement("div",{onClick:function(){d(a)}},"Area ",a+1,r.a.createElement("img",{src:"https://github.com/stillwaiting/emptybars/raw/main/Delete-Button.png",width:16})))}))))};a(46);var O=function(e){var t=this,a=e.pages,n=e.fragmentPages,c=e.fragmentPageAreas,s=e.onFragmentPagesChanges,i=e.onFragmentPageAreasChanged;return r.a.createElement("div",{className:"fragmentPages"},a.map((function(e,c){return r.a.createElement("div",null,r.a.createElement("input",{type:"checkbox",checked:n.indexOf(e.id)>=0,onChange:function(e){return function(e,t){var r=JSON.parse(JSON.stringify(n)),c=a[t];e.target.checked?r.push(c.id):r=r.filter((function(e){return e!=c.id})),s(r,"list of fragment pages updated")}(e,c)}.bind(t)})," Page #",c+1)})),a.map((function(e,a){return n.indexOf(e.id)>=0?r.a.createElement("div",{className:"page"},r.a.createElement(v,{title:"Page #".concat(a+1),imgUrl:e.url,width:500,areas:c[e.id]||[],onNewAreaAdded:function(t){return function(e,t){var a=JSON.parse(JSON.stringify(c));a[e]?a[e].push(t):a[e]=[t],i(a,"page area added")}(e.id,t)}.bind(t),onDeleteArea:function(t){return function(e,t){var a=JSON.parse(JSON.stringify(c));a[e].splice(t,1),i(a,"page area deleted")}(e.id,t)}.bind(t)})):""})))};a(47);var b=function(e){var t=e.fragments,a=e.pages,c=e.videoUrl,s=e.onDataUpdated,o=Object(n.useState)(-1),l=Object(i.a)(o,2),d=l[0],u=l[1],m=Object(n.useState)(0),g=Object(i.a)(m,2),p=g[0],v=g[1],b=Object(n.useRef)(null);return d>=t.length&&(d=-1,u(-1)),r.a.createElement("div",{className:"editor"},r.a.createElement("div",null,r.a.createElement(f,{videoUrl:c,onProgressUpdate:function(e){v(parseFloat(e.toFixed(1)))},ref:b}),d>=0?r.a.createElement("div",null,r.a.createElement(h,{$player:b.current,fragment:t[d],fragmentIdx:d,onFragmentChanged:function(e,n,r){var i=JSON.parse(JSON.stringify(t));i[d]=e,n&&i.splice(d+1,0,n),s({fragments:i,pages:a,videoUrl:c},r)},videoPlayerPosSecs:p,getPrevFragmentEndSec:function(){return 0==d?0:t[d-1].endSec}}),r.a.createElement(O,{pages:a||[],fragmentPages:t[d].pages||[],fragmentPageAreas:t[d].pageAreas||{},onFragmentPagesChanges:function(e,n){var r=JSON.parse(JSON.stringify(t));r[d].pages=e,s({fragments:r,pages:a,videoUrl:c},n)},onFragmentPageAreasChanged:function(e,n){var r=JSON.parse(JSON.stringify(t));r[d].pageAreas=e,s({fragments:r,pages:a,videoUrl:c},n)}})):""),r.a.createElement(S,{fragments:t,onFragmentSelected:function(e,t){u(e),b.current.seekToAndStop(t.startSec)},onFragmentsChanged:function(e,t){s({fragments:e,pages:a,videoUrl:c},t)}}))};a(48),a(49);function y(e){var t=e.lastStateFromLocalStorage,a=e.onDataProvided,c=Object(n.useState)(""),s=Object(i.a)(c,2),o=s[0],l=s[1],d=Object(n.useState)(""),u=Object(i.a)(d,2),m=u[0],g=u[1],p=Object(n.useState)(""),f=Object(i.a)(p,2),h=f[0],S=f[1],v=Object(n.useState)(""),O=Object(i.a)(v,2),b=O[0],y=O[1],E=function(e){g(e)};return r.a.createElement("table",{className:"editorDataProvider"},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"firstCol",onClick:E.bind(this,"new")},r.a.createElement("input",{type:"radio",name:"operation",onChange:E.bind(this,"new"),checked:"new"==m}),"Create new"),r.a.createElement("td",{className:"secondCol"},r.a.createElement("p",null,"Video URL:"),r.a.createElement("p",null,r.a.createElement("input",{type:"text",onChange:function(e){S(e.target.value)},value:h,readOnly:"new"!=m})),r.a.createElement("p",null,"Sheet music pages (one URL per line):"),r.a.createElement("p",null,r.a.createElement("textarea",{onChange:function(e){y(e.target.value)},value:b,readOnly:"new"!=m})))),r.a.createElement("tr",null,r.a.createElement("td",{className:"firstCol",onClick:E.bind(this,"loadOld")},r.a.createElement("input",{type:"radio",name:"operation",onChange:E.bind(this,"loadOld"),checked:"loadOld"==m}),"Load old"),r.a.createElement("td",{className:"secondCol"},r.a.createElement("p",null,"Old fragments content (paste here)"),r.a.createElement("p",null,r.a.createElement("textarea",{onChange:function(e){l(e.target.value)},value:o,readOnly:"loadOld"!=m})))),t?r.a.createElement("tr",null,r.a.createElement("td",{className:"firstCol",onClick:E.bind(this,"restore")},r.a.createElement("input",{type:"radio",name:"operation",onChange:E.bind(this,"restore"),checked:"restore"==m}),"Restore from local storage"),r.a.createElement("td",{className:"secondCol"},r.a.createElement("a",{href:JSON.parse(t).videoUrl,target:"_blank"},JSON.parse(t).videoUrl))):"",m?r.a.createElement("tr",null,r.a.createElement("td",{className:"lastRow"},r.a.createElement("button",{onClick:function(){switch(m){case"loadOld":return void a(JSON.parse(o));case"restore":return void a(JSON.parse(t));case"new":return void a({videoUrl:h,fragments:[],pages:b.trim().split("\n").map((function(e){return e.trim()})).filter((function(e){return e})).map((function(e){return{url:e,id:""+(new Date).getTime()+Math.random()}}))});default:alert("TBD")}}},"Submit")),r.a.createElement("td",{className:"lastRow"})):""))}var E=function(e){var t=Object(n.useState)(Object(p.b)(e)),a=Object(i.a)(t,2),c=a[0],s=a[1],o=Object(n.useState)([]),l=Object(i.a)(o,2),d=l[0],u=l[1],m=Object(n.useState)([]),g=Object(i.a)(m,2),f=g[0],h=g[1],S=Object(n.useRef)(null),v=function(e){s(e),window.localStorage.setItem("emptybarsEditorData",JSON.stringify(Object(p.c)(e)))};return r.a.createElement("div",null,c.videoUrl?r.a.createElement("div",{className:"editorLoader"},r.a.createElement(b,Object.assign({},c,{onDataUpdated:function(e,t){var a={oldData:JSON.parse(JSON.stringify(c)),newData:JSON.parse(JSON.stringify(e)),operationName:t};v(e),d.push(a),u(d),h(f=[])}})),r.a.createElement("textarea",{readOnly:!0,value:JSON.stringify(Object(p.c)(c),null,2),ref:S}),r.a.createElement("div",{className:"copyButton",onClick:function(){S.current.select(),document.execCommand("copy"),alert("Copied!")}},"copy"),d.length>0?r.a.createElement("div",null,"Last operation: ",d[d.length-1].operationName," ",r.a.createElement("span",{className:"undoButton",onClick:function(){var e=d.pop();v(e.oldData),u(d),f.push(e),h(f)}},"undo")):"",f.length>0?r.a.createElement("div",null,"Cancelled operation: ",f[f.length-1].operationName," ",r.a.createElement("span",{className:"undoButton",onClick:function(){var e=f.pop();v(e.newData),d.push(e),u(d),h(f)}},"redo")):""):r.a.createElement(y,{lastStateFromLocalStorage:window.localStorage.getItem("emptybarsEditorData"),onDataProvided:function(e){v(Object(p.b)(e))}}))},N=a(13);Object(N.a)((function(e,t){var a=t.fragments,n=t.pages,c=t.videoUrl;t.videoTitle;s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(E,{fragments:a||[],pages:n||[],videoUrl:c})),e)}))}},[[16,1,2]]]);
//# sourceMappingURL=main.5d7a75fe.chunk.js.map