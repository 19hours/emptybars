(this.webpackJsonpreactplayer=this.webpackJsonpreactplayer||[]).push([[0],{16:function(e,t,a){e.exports=a(50)},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){},48:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(9),c=a.n(s),i=a(1),o=a(10),l=a(11),d=a(14),u=a(15),m=a(12),g=a.n(m),p=a(3),S=(a(41),function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={progress:-1,duration:-1,gotoAfterStopSec:-1,endSec:-1,playing:!0},n.$player=r.a.createRef(),n}return Object(l.a)(a,[{key:"handleDuration",value:function(e){this.setState({duration:e})}},{key:"stopAndReturn",value:function(){var e=this.state.gotoAfterStopSec;this.setState({endSec:-1,gotoAfterStopSec:-1,playing:!1}),this.$player.current.seekTo(e,"seconds")}},{key:"handleProgress",value:function(e){var t=e.playedSeconds;this.state.endSec>0&&t>this.state.endSec&&this.stopAndReturn(),this.setState({progress:t}),this.props.onProgressUpdate(t)}},{key:"handleOnPlay",value:function(){this.setState({playing:!0})}},{key:"handleOnReady",value:function(){console.log("ready!")}},{key:"handleStop",value:function(){this.setState({playing:!1})}},{key:"playSegment",value:function(e,t,a){this.$player.current.seekTo(e,"seconds"),this.setState({gotoAfterStopSec:Math.max("STAY_AT_END"===a?t:e,0),endSec:Math.max(t,.01),playing:!0})}},{key:"seekTo",value:function(e){this.$player.current.seekTo(e,"seconds")}},{key:"seekToAndStop",value:function(e){this.setState({playing:!1}),this.$player.current.seekTo(e,"seconds")}},{key:"maybeStop1SecPlaying",value:function(e){this.state.playing&&this.state.gotoAfterStopSec>0?(this.stopAndReturn(),setTimeout(e.bind(this),100)):e()}},{key:"onMoveToClick",value:function(e){var t=this;this.maybeStop1SecPlaying((function(){t.$player.current.seekTo(Math.max(t.state.progress+e,0),"seconds")}))}},{key:"handlePlayOneSecBefore",value:function(){var e=this;this.maybeStop1SecPlaying((function(){e.playSegment(e.state.progress-1,e.state.progress,"STAY_AT_END")}))}},{key:"handlePlayOneSecAfter",value:function(){var e=this;this.maybeStop1SecPlaying((function(){e.playSegment(e.state.progress,e.state.progress+1,"STAY_AT_START")}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"playWithNavButtons"},r.a.createElement(g.a,{ref:this.$player,url:this.props.videoUrl,width:"100%",height:"100%",onDuration:this.handleDuration.bind(this),onProgress:this.handleProgress.bind(this),onPlay:this.handleOnPlay.bind(this),onReady:this.handleOnReady.bind(this),progressInterval:100,onPause:this.handleStop.bind(this),onEnded:this.handleStop.bind(this),playing:this.state.playing,controls:!0}),r.a.createElement("div",{className:"positionAndControls"},"Current position: ",r.a.createElement("span",{className:"position"},Object(p.a)(this.state.progress)),r.a.createElement("div",{className:"controls"},[-5,-1,-.5,-.1,.1,.5,1,5].map((function(t){return r.a.createElement("div",{className:"gotoButton",onClick:function(){return e.onMoveToClick(t)}.bind(e)},t>0?"+"+t:t)})),r.a.createElement("div",{className:"gotoButton",onClick:this.handlePlayOneSecBefore.bind(this)},"Play 1 sec before"),r.a.createElement("div",{className:"gotoButton",onClick:this.handlePlayOneSecAfter.bind(this)},"Play 1 sec after"))))}}]),a}(r.a.Component));a(42);var f=function(e){var t=e.$player,a=e.segment,n=e.segmentIdx,s=e.videoPlayerPosSecs,c=e.onSegmentChanged,i=e.getPrevSegmentEndSec;return r.a.createElement("div",{className:"segmentPosition"},r.a.createElement("div",{className:"title"},"Selected Segment #",n+1," (",Object(p.a)(a.startSec)," - ",Object(p.a)(a.endSec),")"),r.a.createElement("div",{className:"playerPosition"},function(){var e,t=s-a.startSec,n=s-a.endSec;return t>=0&&n<=0?e="inside":t<0?e="before":n>0&&(e="after"),r.a.createElement("span",{className:e},"Segment start delta=",t.toFixed(1),", delta end delta=",n.toFixed(1))}()),r.a.createElement("div",{className:"controls"},r.a.createElement("div",{className:"button",onClick:function(){t.playSegment(a.startSec,a.endSec,"STAY_AT_START")}},"Play the whole segment"),r.a.createElement("div",{className:"group"},r.a.createElement("div",{className:"button",onClick:function(){t.seekToAndStop(a.startSec)}},"Jump to segment start"),r.a.createElement("div",{className:"button",onClick:function(){t.seekToAndStop(a.endSec)}},"Jump to segment end")),r.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a));e.startSec=i(),c(e,void 0,"update segment start time")}},"Set segment start at prev. segment end"),r.a.createElement("div",{className:"group"},r.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a));e.startSec=parseFloat(s.toFixed(1)),c(e,void 0,"update segment start time")}},"Set as segment's start time"),r.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a));e.endSec=parseFloat(s.toFixed(1)),c(e,void 0,"update segment end time")}},"Set as segment's end time")),a.startSec<s&&a.endSec>s?r.a.createElement("div",{className:"button",onClick:function(){var e=JSON.parse(JSON.stringify(a)),t=a.endSec;e.endSec=parseFloat(s.toFixed(1)),c(e,JSON.parse(JSON.stringify({startSec:e.endSec,endSec:t,pages:e.pages})),"split segment")}},"Split segment at ",Object(p.a)(s)):""))};a(43);var h=function(e){var t=e.segments,a=e.onSegmentSelected,s=e.onSegmentsChanged,c=Object(n.useState)(-1),o=Object(i.a)(c,2),l=o[0],d=o[1],u=Object(n.useState)(-1),m=Object(i.a)(u,2),g=m[0],S=m[1],f=Object(n.useRef)(null),h=function(e,t){d(e),console.log(t),a(e,t)};return Object(n.useEffect)((function(){f.current&&g>=0&&(f.current.scrollIntoView(),S(-1))})),r.a.createElement("div",{className:"segments"},r.a.createElement("div",{className:"scrolling"},r.a.createElement("div",{className:"addButton",onClick:function(){var e=JSON.parse(JSON.stringify(t));e.length>0?e.push({startSec:t[t.length-1].endSec,endSec:t[t.length-1].endSec+10}):e.push({startSec:0,endSec:10}),s(e,"add segment"),S(e.length-1),h(e.length-1,e[e.length-1])}.bind(null)},"Add segment"),t.map((function(e,a){var n=e.startSec,s=e.endSec;return r.a.createElement("div",{className:"button ".concat(l===a?"active":""),key:a,onClick:h.bind(null,a,t[a]),ref:a==g?f:null},"Segment ",a+1,": ",Object(p.a)(n)," - ",Object(p.a)(s))}))))};a(44);a(45);var v=function(e){var t=this,a=e.title,s=e.imgUrl,c=e.width,o=e.areas,l=e.onNewAreaAdded,d=e.onDeleteArea,u=Object(n.useState)(null),m=Object(i.a)(u,2),g=m[0],p=m[1],S=Object(n.useState)(!1),f=Object(i.a)(S,2),h=f[0],v=f[1],O=Object(n.useState)(!1),b=Object(i.a)(O,2),y=b[0],E=b[1],N=Object(n.useState)(0),j=Object(i.a)(N,2),k=j[0],C=j[1],P=Object(n.useState)(0),A=Object(i.a)(P,2),w=A[0],J=A[1],T=Object(n.useState)(0),x=Object(i.a)(T,2),D=x[0],U=x[1],R=Object(n.useState)(0),M=Object(i.a)(R,2),B=M[0],I=M[1],F=Object(n.useState)(-1),$=Object(i.a)(F,2),_=$[0],L=$[1],Y=Object(n.useRef)(null);g||((g=new Image).src=s,g.onload=function(){v(!0)},p(g));var V=1*c/g.width,W=100,X=function(){if(Y&&Y.current&&g&&g.width&&g.height&&h){var e=Y.current.getContext("2d");W=parseInt(g.height*V),e.drawImage(g,0,0,g.width,g.height,0,0,c,W),o.forEach((function(t,a){e.fillStyle=a==_?"rgba(255, 0, 0, 0.7)":"rgba(255, 255, 0, 0.5)",e.fillRect(t.x*V,t.y*V,t.width*V,t.height*V)})),y&&(e.fillStyle="rgba(255, 0, 0, 0.5)",e.fillRect(k,w,D,B))}};function q(e,t){var a=e.getBoundingClientRect();return[t.clientX-a.left,t.clientY-a.top]}return X(),Object(n.useEffect)((function(){X()})),r.a.createElement("div",{className:"imageAreas"},r.a.createElement("div",{className:"canvas"},r.a.createElement("div",{className:"title"},a),r.a.createElement("canvas",{width:c,height:W,ref:Y,onMouseMove:function(e){var t=q(Y.current,e),a=Object(i.a)(t,2),n=a[0],r=a[1];y&&(U(n-k),I(r-w))},onMouseOut:function(e){E(!1)},onMouseDown:function(e){var t=q(Y.current,e),a=Object(i.a)(t,2),n=a[0],r=a[1];E(!0),C(n),J(r),I(0),U(0)},onMouseUp:function(e){W>10&&c>10&&l({x:parseInt(k/V),y:parseInt(w/V),width:parseInt(D/V),height:parseInt(B/V)}),E(!1)}})),r.a.createElement("div",{className:"controls"},o.map((function(e,a){return r.a.createElement("div",{className:"item",onMouseOver:function(){L(a)}.bind(t),onMouseOut:function(){L(-1)}.bind(t)},r.a.createElement("div",{onClick:function(){d(a)}},"Area ",a+1,r.a.createElement("img",{src:"https://github.com/stillwaiting/emptybars/raw/main/Delete-Button.png",width:16})))}))))};a(46);var O=function(e){var t=this,a=e.pages,n=e.segmentPages,s=e.segmentPageAreas,c=e.onSegmentPagesChanges,i=e.onSegmentPageAreasChanged;return r.a.createElement("div",{className:"segmentPages"},a.map((function(e,s){return r.a.createElement("div",null,r.a.createElement("input",{type:"checkbox",checked:n.indexOf(e.id)>=0,onChange:function(e){return function(e,t){var r=JSON.parse(JSON.stringify(n)),s=a[t];e.target.checked?r.push(s.id):r=r.filter((function(e){return e!=s.id})),c(r,"list of segment pages updated")}(e,s)}.bind(t)})," Page #",s+1)})),a.map((function(e,a){return n.indexOf(e.id)>=0?r.a.createElement("div",{className:"page"},r.a.createElement(v,{title:"Page #".concat(a+1),imgUrl:e.url,width:500,areas:s[e.id]||[],onNewAreaAdded:function(t){return function(e,t){var a=JSON.parse(JSON.stringify(s));a[e]?a[e].push(t):a[e]=[t],i(a,"page area added")}(e.id,t)}.bind(t),onDeleteArea:function(t){return function(e,t){var a=JSON.parse(JSON.stringify(s));a[e].splice(t,1),i(a,"page area deleted")}(e.id,t)}.bind(t)})):""})))};a(47);var b=function(e){var t=e.segments,a=e.pages,s=e.videoUrl,c=e.onDataUpdated,o=Object(n.useState)(-1),l=Object(i.a)(o,2),d=l[0],u=l[1],m=Object(n.useState)(0),g=Object(i.a)(m,2),p=g[0],v=g[1],b=Object(n.useRef)(null);return d>=t.length&&(d=-1,u(-1)),r.a.createElement("div",{className:"editor"},r.a.createElement("div",null,r.a.createElement(S,{videoUrl:s,onProgressUpdate:function(e){v(parseFloat(e.toFixed(1)))},ref:b}),d>=0?r.a.createElement("div",null,r.a.createElement(f,{$player:b.current,segment:t[d],segmentIdx:d,onSegmentChanged:function(e,n,r){var i=JSON.parse(JSON.stringify(t));i[d]=e,n&&i.splice(d+1,0,n),c({segments:i,pages:a,videoUrl:s},r)},videoPlayerPosSecs:p,getPrevSegmentEndSec:function(){return 0==d?0:t[d-1].endSec}}),r.a.createElement(O,{pages:a||[],segmentPages:t[d].pages||[],segmentPageAreas:t[d].pageAreas||{},onSegmentPagesChanges:function(e,n){var r=JSON.parse(JSON.stringify(t));r[d].pages=e,c({segments:r,pages:a,videoUrl:s},n)},onSegmentPageAreasChanged:function(e,n){var r=JSON.parse(JSON.stringify(t));r[d].pageAreas=e,c({segments:r,pages:a,videoUrl:s},n)}})):""),r.a.createElement(h,{segments:t,onSegmentSelected:function(e,t){u(e),b.current.seekToAndStop(t.startSec)},onSegmentsChanged:function(e,t){c({segments:e,pages:a,videoUrl:s},t)}}))};a(48),a(49);function y(e){var t=e.lastStateFromLocalStorage,a=e.onDataProvided,s=Object(n.useState)(""),c=Object(i.a)(s,2),o=c[0],l=c[1],d=Object(n.useState)(""),u=Object(i.a)(d,2),m=u[0],g=u[1],p=Object(n.useState)(""),S=Object(i.a)(p,2),f=S[0],h=S[1],v=Object(n.useState)(""),O=Object(i.a)(v,2),b=O[0],y=O[1],E=function(e){g(e)};return r.a.createElement("table",{className:"editorDataProvider"},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"firstCol",onClick:E.bind(this,"new")},r.a.createElement("input",{type:"radio",name:"operation",onChange:E.bind(this,"new"),checked:"new"==m}),"Create new"),r.a.createElement("td",{className:"secondCol"},r.a.createElement("p",null,"Video URL:"),r.a.createElement("p",null,r.a.createElement("input",{type:"text",onChange:function(e){h(e.target.value)},value:f,readOnly:"new"!=m})),r.a.createElement("p",null,"Sheet music pages (one URL per line):"),r.a.createElement("p",null,r.a.createElement("textarea",{onChange:function(e){y(e.target.value)},value:b,readOnly:"new"!=m})))),r.a.createElement("tr",null,r.a.createElement("td",{className:"firstCol",onClick:E.bind(this,"loadOld")},r.a.createElement("input",{type:"radio",name:"operation",onChange:E.bind(this,"loadOld"),checked:"loadOld"==m}),"Load old"),r.a.createElement("td",{className:"secondCol"},r.a.createElement("p",null,"Old segments content (paste here)"),r.a.createElement("p",null,r.a.createElement("textarea",{onChange:function(e){l(e.target.value)},value:o,readOnly:"loadOld"!=m})))),t?r.a.createElement("tr",null,r.a.createElement("td",{className:"firstCol",onClick:E.bind(this,"restore")},r.a.createElement("input",{type:"radio",name:"operation",onChange:E.bind(this,"restore"),checked:"restore"==m}),"Restore from local storage"),r.a.createElement("td",{className:"secondCol"},r.a.createElement("a",{href:JSON.parse(t).videoUrl,target:"_blank"},JSON.parse(t).videoUrl))):"",m?r.a.createElement("tr",null,r.a.createElement("td",{className:"lastRow"},r.a.createElement("button",{onClick:function(){switch(m){case"loadOld":return void a(JSON.parse(o));case"restore":return void a(JSON.parse(t));case"new":return void a({videoUrl:f,segments:[],pages:b.trim().split("\n").map((function(e){return e.trim()})).filter((function(e){return e})).map((function(e){return{url:e,id:""+(new Date).getTime()+Math.random()}}))});default:alert("TBD")}}},"Submit")),r.a.createElement("td",{className:"lastRow"})):""))}var E=function(e){var t=Object(n.useState)(Object(p.b)(e)),a=Object(i.a)(t,2),s=a[0],c=a[1],o=Object(n.useState)([]),l=Object(i.a)(o,2),d=l[0],u=l[1],m=Object(n.useState)([]),g=Object(i.a)(m,2),S=g[0],f=g[1],h=Object(n.useRef)(null),v=function(e){c(e),window.localStorage.setItem("emptybarsEditorData",JSON.stringify(Object(p.c)(e)))};return r.a.createElement("div",null,s.videoUrl?r.a.createElement("div",{className:"editorLoader"},r.a.createElement(b,Object.assign({},s,{onDataUpdated:function(e,t){var a={oldData:JSON.parse(JSON.stringify(s)),newData:JSON.parse(JSON.stringify(e)),operationName:t};v(e),d.push(a),u(d),f(S=[])}})),r.a.createElement("textarea",{readOnly:!0,value:JSON.stringify(Object(p.c)(s),null,2),ref:h}),r.a.createElement("div",{className:"copyButton",onClick:function(){h.current.select(),document.execCommand("copy"),alert("Copied!")}},"copy"),d.length>0?r.a.createElement("div",null,"Last operation: ",d[d.length-1].operationName," ",r.a.createElement("span",{className:"undoButton",onClick:function(){var e=d.pop();v(e.oldData),u(d),S.push(e),f(S)}},"undo")):"",S.length>0?r.a.createElement("div",null,"Cancelled operation: ",S[S.length-1].operationName," ",r.a.createElement("span",{className:"undoButton",onClick:function(){var e=S.pop();v(e.newData),d.push(e),u(d),f(S)}},"redo")):""):r.a.createElement(y,{lastStateFromLocalStorage:window.localStorage.getItem("emptybarsEditorData"),onDataProvided:function(e){v(Object(p.b)(e))}}))},N=a(13);Object(N.a)((function(e,t){var a=t.segments,n=t.pages,s=t.videoUrl;t.videoTitle;c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(E,{segments:a||[],pages:n||[],videoUrl:s})),e)}))}},[[16,1,2]]]);
//# sourceMappingURL=main.7dca4805.chunk.js.map