(this.webpackJsonpreactplayer=this.webpackJsonpreactplayer||[]).push([[0],{41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){},46:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(6),s=a.n(i),c=a(2),l=a(11),o=a(12),u=a(17),m=a(15),d=a(13),g=a.n(d),p=a(5),h=(a(41),function(e){Object(u.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={progress:-1,duration:-1,gotoAfterStopSec:-1,endSec:-1,playing:!1,playbackSpeed:100,showControls:!1},n.$player=r.a.createRef(),n}return Object(o.a)(a,[{key:"_handleDuration",value:function(e){this.setState({duration:e})}},{key:"_stopAndReturn",value:function(){var e=this.state.gotoAfterStopSec;this.setState({endSec:-1,gotoAfterStopSec:-1,playing:!1}),this.$player.current.seekTo(e,"seconds")}},{key:"_handleProgress",value:function(e){var t=e.playedSeconds;this.state.endSec>0&&t>this.state.endSec&&this._stopAndReturn(),this.setState({progress:t}),this.props.onProgressUpdate(t)}},{key:"_handleOnPlay",value:function(){this.state.playing||this.setState({playing:!0,endSec:-1,gotoAfterStopSec:-1})}},{key:"_handleOnStart",value:function(){this.setState({showControls:!0}),this.props.onPlay()}},{key:"_handleStop",value:function(){this.setState({playing:!1}),this.props.onStop()}},{key:"_handleOnSelect",value:function(e){this.setState({playbackSpeed:e.target.value})}},{key:"playSegment",value:function(e,t,a){this.$player.current.seekTo(e,"seconds"),this.setState({gotoAfterStopSec:Math.max("STAY_AT_END"===a?t:e,0),endSec:Math.max(t,.01),playing:!0})}},{key:"render",value:function(){return r.a.createElement("div",{className:"playWithNavButtons"},r.a.createElement(g.a,{ref:this.$player,url:this.props.videoUrl,width:"100%",height:"100%",onDuration:this._handleDuration.bind(this),onProgress:this._handleProgress.bind(this),onPlay:this._handleOnPlay.bind(this),onStart:this._handleOnStart.bind(this),progressInterval:100,onPause:this._handleStop.bind(this),onEnded:this._handleStop.bind(this),playbackRate:this.state.playbackSpeed/100,playing:this.state.playing,controls:!0,config:{youtube:{playerVars:{origin:window.location.origin}}}}),this.state.showControls?r.a.createElement("div",{className:"positionAndControls"},"Current position: ",r.a.createElement("span",{className:"position"},Object(p.a)(this.state.progress)),r.a.createElement("br",null),"Playback speed:",r.a.createElement("select",{value:this.state.playbackSpeed,onChange:this._handleOnSelect.bind(this)},[25,50,60,70,80,90,100,125,150,200].map((function(e){return r.a.createElement("option",{key:"option".concat(e),value:e},e,"%")})))):"")}}]),a}(r.a.Component)),f=a(16);a(42);var v=function(e){var t=e.segments,a=e.playInterval,n=e.activeSegments,i=e.playInput,s=e.setPlayInput,l=function(e){s(e.target.value)},o=function(e){l({target:{value:e+1+":"+(e+1)}}),a(t[e].startSec,t[e].endSec)},u=function(e){var a=(e=e.split("-").join("+-")).split("+"),n=parseInt(a[0]);if(n!=a[0])return[!1,!1];if(n<=0||n>t.length)return console.error("Segment "+n+" is out of range. Max="+t.length),[!1,!1];if(1==a.length)return[n,0];if(2==a.length){var r=a[1].split("s").join("").trim();return function(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}(r)?[n,parseFloat(r)]:(console.error(r+" is not a number"),[!1,!1])}return[!1,!1]},m=function(){var e=i.replace(" ","").split(":");if(2!=e.length)return!1;var t=e[0],a=e[1],n=u(t),r=Object(c.a)(n,2),s=r[0],l=r[1];if(!s)return!1;var o=u(a),m=Object(c.a)(o,2),d=m[0],g=m[1];return!!d&&[s,l,d,g]},d=function(e){var t=m();if(t){var a=Object(c.a)(t,4),n=a[0],r=(a[1],a[2]);a[3];return n<=e+1&&r>=e+1}return!1};return r.a.createElement("div",{className:"segments"},r.a.createElement("div",null,"Segments:"),r.a.createElement("div",{className:"scrolling"},t.map((function(e,t){e.startSec,e.endSec;return r.a.createElement("div",{tabIndex:0,className:"button ".concat(n.indexOf(t)>=0?"active":""," ").concat(d(t)?"inPlayInput":""),key:t,onClick:o.bind(null,t)},"#",t+1)}))),r.a.createElement("div",{className:"playSegmentsSection"},"Play segments: ",r.a.createElement("input",{onChange:l,value:i,className:m()?"":"errorInput"}),r.a.createElement(f.a,{id:"formats"},r.a.createElement("div",null,r.a.createElement("div",null,"Allowed formats:",r.a.createElement("ul",{className:"allowedFormats"},r.a.createElement("li",null,r.a.createElement("span",null,"1:1")," - play segment 1 "),r.a.createElement("li",null,r.a.createElement("span",null,"1:3")," - play segments 1, 2 and 3"),r.a.createElement("li",null,r.a.createElement("span",null,"1-10s:2+15.2s")," - play segments 1 and 2, ",r.a.createElement("br",null),"but start 10 seconds earlier and finish 15.2 seconds later"))))),"\xa0 ",r.a.createElement("img",{src:"https://images2.imgbox.com/02/01/VzjEL9yb_o.png?download=true",align:"center","data-tip":!0,"data-for":"formats"})),m()?r.a.createElement("button",{onClick:function(){var e=m(),n=Object(c.a)(e,4),r=n[0],i=n[1],s=n[2],l=n[3];a(t[r-1].startSec+i,t[s-1].endSec+l)}},"Play"):"")};a(43);var S=function(e){var t,a,i=e.title,s=e.image,l=e.width,o=e.areas,u=e.onImageClicked,m=Object(n.useRef)(null);s&&s.width&&s.height?(t=1*l/s.width,a=parseInt(s.height*t)):(t=-1,a=-1);var d=function(){if(s&&s.width&&s.height&&m&&m.current){var e=m.current.getContext("2d");e.drawImage(s,0,0,s.width,s.height,0,0,l,a),o.forEach((function(a,n){e.fillStyle="rgba(255, 255, 0, 0.5)",e.fillRect(a.x*t,a.y*t,a.width*t,a.height*t)}))}};return Object(n.useEffect)((function(){d()})),s&&s.width&&s.height?(d(),r.a.createElement("div",{className:"imageAreas"},r.a.createElement("div",{className:"canvas"},r.a.createElement("div",{className:"title"},i),r.a.createElement("canvas",{width:l,height:a,ref:m,onClick:function(e){var a=function(e,t){var a=e.getBoundingClientRect();return[t.clientX-a.left,t.clientY-a.top]}(m.current,e),n=Object(c.a)(a,2),r=n[0],i=n[1];u(r/t,i/t)}})))):r.a.createElement("div",{className:"imageAreas"},r.a.createElement("div",{className:"canvas"},r.a.createElement("div",{className:"title"},i),r.a.createElement("div",null,"Error loading")))};a(44);var b=function(e){var t=this,a=e.images,i=e.pages,s=e.segmentPageAreas,l=e.skipScrollingFromTime,o=e.onPageClicked,u=Object(n.useState)(1),m=Object(c.a)(u,2),d=m[0],g=m[1],p=Object(n.useState)(""),h=Object(c.a)(p,2),f=h[0],v=h[1],b=Object(n.useRef)(),y=function(){for(var e=0;e<b.current.childNodes.length;e++)if("scrollArea"==b.current.childNodes[e].className)return b.current.childNodes[e];throw"Cannot find scrollArea"},E=function(){return parseInt(500*d*297/210+20)},O=function(){return l&&(new Date).getTime()-l<2e3},N=function(){var e=JSON.stringify(s);if(f!=e&&b.current){var t=!0,a=function(){for(var e=-1,t=0;t<i.length;t++){var a=i[t].id;if(s[a]&&s[a].length){e=t;break}}return e}();if(a>=0){var n=function(e){for(var t=y(),a=0,n=0;n<t.childNodes.length;n++)if("page"==t.childNodes[n].className){if(a==e)return t.childNodes[n];a++}throw"cannot find page "+e}(a);O()||(b.current.scrollTop=n.offsetTop-y().offsetTop),0==n.offsetTop&&(t=!1),!O()&&Object.keys(s).length>1&&(b.current.scrollTop+=parseInt(E()/2))}t&&v(e)}};Object(n.useEffect)(N,[]),N();var j={height:E()+"px",width:parseInt(500*d+20)+"px"};return r.a.createElement("div",null,r.a.createElement("div",{className:"segmentPages",ref:b,style:j},r.a.createElement("div",{className:"zoom"},r.a.createElement("img",{src:"https://images2.imgbox.com/22/21/4gO3I6ii_o.png?download=true",width:"32",onClick:function(){g(d+.1)}}),r.a.createElement("img",{src:"https://images2.imgbox.com/1b/b2/L4tgMq2a_o.png?download=true",width:"32",onClick:function(){g(d-.1)}}),r.a.createElement("img",{src:"https://images2.imgbox.com/f3/d5/paRxNKm0_o.png?download=true",width:"32",onClick:function(){g(1)}})),r.a.createElement("div",{className:"scrollArea"},i.map((function(e,n){return r.a.createElement("div",{className:"page",key:"segmentpage"+n},r.a.createElement(S,{title:"Page #".concat(n+1),image:a[n],onImageClicked:function(e,t){return function(e,t,a){var n=i[e].id;o(n,t,a)}(n,e,t)}.bind(t),width:parseInt(500*d),areas:s[e.id]||[]}))})))))};a(45);var y=function(e){var t=e.segments,a=e.images,i=e.pages,s=e.videoUrl,l=Object(n.useState)([]),o=Object(c.a)(l,2),u=o[0],m=o[1],d=Object(n.useState)(!1),g=Object(c.a)(d,2),p=g[0],f=g[1],S=Object(n.useState)(!1),y=Object(c.a)(S,2),E=y[0],O=y[1],N=Object(n.useState)(!1),j=Object(c.a)(N,2),w=j[0],k=j[1],I=Object(n.useState)(0),A=Object(c.a)(I,2),P=(A[0],A[1]),C=Object(n.useState)(""),_=Object(c.a)(C,2),x=_[0],T=_[1],M=Object(n.useRef)(null),R=function(e,t){M.current.playSegment(e,t)},D=function(e){var a=[];t.forEach((function(t,n){t.startSec<=e&&t.endSec>=e&&a.push(n)})),m(a)},F=function(e,t,a){for(var n=0;n<e.length;n++){var r=e[n],i=r.x,s=r.y,c=i+r.width,l=s+r.height;if(t>Math.min(i,c)&&t<Math.max(i,c)&&a>Math.min(s,l)&&a<Math.max(s,l))return!0}return!1};return r.a.createElement("div",{className:p?"player":"player notInitialised"},r.a.createElement("div",{className:"segmentPagesWrapper"},r.a.createElement(b,{images:a,pages:i||[],onPageClicked:function(e,a,n){for(var r=0;r<t.length;r++){var i=t[r];if(F(i.pageAreas[e]||[],a,n))return T(r+1+":"+(r+1)),k(!0),O((new Date).getTime()),D(i.startSec),void R(i.startSec,i.endSec)}},skipScrollingFromTime:E,segmentPageAreas:function(){var e={};return u.forEach((function(a){for(var n in t[a].pageAreas){var r=t[a].pageAreas[n];e[n]?e[n]=e[n].concat(r):e[n]=r}})),e}()})),r.a.createElement("div",{className:"playerAndSegments"},r.a.createElement(h,{videoUrl:s,onProgressUpdate:function(e){P(parseFloat(e.toFixed(1))),w&&(O((new Date).getTime()),k(!1)),D(e)},ref:M,onPlay:function(){f(!0)},onStop:function(){O(!1),k(!1)}}),r.a.createElement(v,{segments:t,playInterval:R,activeSegments:u,playInput:x,setPlayInput:T})))},E=a(14),O=function(e){var t=e.imageUrls,a=e.onImagesLoaded,i=Object(n.useState)(new Array(t.length).fill(0)),s=Object(c.a)(i,2),l=s[0],o=s[1];Object(n.useEffect)((function(){var e=new Array(t.length).fill(0),n=setInterval((function(){for(var t=parseInt(3*Math.random()),a=0;a<e.length;a++)e[a]+=t,e[a]>50&&(e[a]-=parseInt(t/2)),e[a]>100&&(e[a]=100);o(JSON.parse(JSON.stringify(e)))}),500),r=0,i=function(i){e[i]=100,o(JSON.parse(JSON.stringify(e))),(r+=1)>=t.length&&(a(s),clearInterval(n))},s=t.map((function(e,t){var a=new Image;return a.src=e,a.onload=function(){i(t)},a.onerror=function(e){console.error(e),i(t)},a}))}),[]);return r.a.createElement("div",null,"Loading ",function(){var e=parseInt(l.reduce((function(e,t){return e+t}),0)/Math.max(0,l.length));return parseInt(l.reduce((function(e,t){return e+t}),0)/Math.max(0,l.length))+"%"+(100==e?"...":"")}())};Object(E.a)((function(e,t){s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(O,{imageUrls:t.pages.map((function(e){return e.url})),onImagesLoaded:function(a){return s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(y,Object.assign({images:a},Object(p.b)(t)))),e)}})),e)}))}},[[46,1,2]]]);
//# sourceMappingURL=main.b65a3993.chunk.js.map